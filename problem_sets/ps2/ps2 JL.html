<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jiaxuan Liu">
<meta name="dcterms.date" content="2024-10-18">

<title>Problem Set 2 Knitted</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="ps2 JL_files/libs/clipboard/clipboard.min.js"></script>
<script src="ps2 JL_files/libs/quarto-html/quarto.js"></script>
<script src="ps2 JL_files/libs/quarto-html/popper.min.js"></script>
<script src="ps2 JL_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ps2 JL_files/libs/quarto-html/anchor.min.js"></script>
<link href="ps2 JL_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ps2 JL_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ps2 JL_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ps2 JL_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ps2 JL_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="ps2-JL.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Problem Set 2 Knitted</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jiaxuan Liu </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 18, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="problem-set-2-report" class="level1">
<h1>Problem Set 2 Report</h1>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<ol type="1">
<li>“This submission is my work alone and complies with the 30538 integrity policy.” Add your initials to indicate your agreement: <strong>JL</strong></li>
<li>“I have uploaded the names of anyone I worked with on the problem set here” asdgla ;sdgnawe;oe</li>
<li>Late coins used this pset: <strong><em>1</em></strong></li>
</ol>
</section>
<section id="data-cleaning-continued" class="level1">
<h1>Data cleaning continued</h1>
</section>
<section id="q1-counting-na-values-by-defining-function" class="level1">
<h1>Q1: Counting NA values by defining function</h1>
<p>For each column, how many rows are NA? Write a function that returns a two-column DataFrame where each row is a variable, the first column of the DataFrame is the name of each variable, and the second column of the DataFrame is the number of times that the column is NA.</p>
</section>
<section id="importing-the-dataset" class="level1">
<h1>Importing the dataset</h1>
<div id="4214c829" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jupyter</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># File path for the parking tickets dataset</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">'/Users/doudouliu/Desktop/python 2/student30538/problem_sets/ps2/data/parking_tickets_one_percent.csv'</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Reading the CSV file</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(file_path)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Display first few rows to ensure the dataset is loaded correctly</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Unnamed: 0  ticket_number           issue_date violation_location  \
0           1     51482901.0  2007-01-01 01:25:00    5762 N AVONDALE   
1           2     50681501.0  2007-01-01 01:51:00    2724 W FARRAGUT   
2           3     51579701.0  2007-01-01 02:22:00       1748 W ESTES   
3           4     51262201.0  2007-01-01 02:35:00    4756 N SHERIDAN   
4           5     51898001.0  2007-01-01 03:50:00    7134 S CAMPBELL   

                                license_plate_number license_plate_state  \
0  d41ee9a4cb0676e641399ad14aaa20d06f2c6896de6366...                  IL   
1  3395fd3f71f18f9ea4f0a8e1f13bf0aa15052fc8e5605a...                  IL   
2  302cb9c55f63ff828d7315c5589d97f1f8144904d66eb3...                  IL   
3  94d018f52c7990cea326d1810a3278e2c6b1e8b44f3c52...                  IL   
4  876dd3a95179f4f1d720613f6e32a5a7b86b0e6f988bf4...                  IL   

  license_plate_type      zipcode violation_code  \
0                PAS  606184118.0       0964090E   
1                PAS  606454911.0       0964090E   
2                PAS  604116803.0       0964150B   
3                PAS  606601345.0       0976160F   
4                PAS  606291432.0       0964100A   

                      violation_description  ...  fine_level2_amount  \
0                RESIDENTIAL PERMIT PARKING  ...                 100   
1                RESIDENTIAL PERMIT PARKING  ...                 100   
2       PARKING/STANDING PROHIBITED ANYTIME  ...                 100   
3  EXPIRED PLATES OR TEMPORARY REGISTRATION  ...                 100   
4                WITHIN 15' OF FIRE HYDRANT  ...                 200   

  current_amount_due total_payments  ticket_queue  ticket_queue_date  \
0                0.0           50.0          Paid         2007-03-20   
1                0.0           50.0          Paid         2007-01-31   
2              122.0            0.0        Notice         2007-02-28   
3                0.0           50.0          Paid         2007-01-11   
4                0.0          100.0          Paid         2007-04-25   

   notice_level  hearing_disposition notice_number officer  \
0          DETR               Liable  5.080059e+09   17266   
1          VIOL                  NaN  5.079876e+09   10799   
2          SEIZ                  NaN  5.037862e+09   17253   
3           NaN                  NaN  5.075310e+09    3307   
4          DETR                  NaN  5.073568e+09   16820   

                        address  
0  5700 n avondale, chicago, il  
1  2700 w farragut, chicago, il  
2     1700 w estes, chicago, il  
3  4700 n sheridan, chicago, il  
4  7100 s campbell, chicago, il  

[5 rows x 24 columns]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/b0/6kybjmv57sv8drq7v4kr7w240000gn/T/ipykernel_2628/3451754831.py:9: DtypeWarning: Columns (7) have mixed types. Specify dtype option on import or set low_memory=False.
  df = pd.read_csv(file_path)</code></pre>
</div>
</div>
</section>
<section id="how-many-nas" class="level1">
<h1>How many NAs</h1>
<div id="6b16c37a" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Nna(df):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  na_N <span class="op">=</span> df.isna().<span class="bu">sum</span>().reset_index()  <span class="co"># convert to DataFrame format with NA counts</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  na_N.columns <span class="op">=</span> [<span class="st">'variable'</span>, <span class="st">'na_count'</span>]  <span class="co"># rename columns</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> na_N</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (Nna(df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 variable  na_count
0              Unnamed: 0         0
1           ticket_number         0
2              issue_date         0
3      violation_location         0
4    license_plate_number         0
5     license_plate_state        97
6      license_plate_type      2054
7                 zipcode     54115
8          violation_code         0
9   violation_description         0
10                   unit        29
11       unit_description         0
12           vehicle_make         0
13     fine_level1_amount         0
14     fine_level2_amount         0
15     current_amount_due         0
16         total_payments         0
17           ticket_queue         0
18      ticket_queue_date         0
19           notice_level     84068
20    hearing_disposition    259899
21          notice_number         0
22                officer         0
23                address         0</code></pre>
</div>
</div>
</section>
<section id="q2-three-variables-are-missing-much-more-frequently-than-the-others.-why-hint-look-at-some-rows-and-read-the-data-dictionary-written-by-propublica" class="level1">
<h1>Q2 Three variables are missing much more frequently than the others. Why? (Hint: look at some rows and read the data dictionary written by ProPublica)</h1>
</section>
<section id="hearing_disposition-has-a-missing-vlaue-of-259899-given-that-the-contested-tickets-that-got-taken-to-the-court-and-make-it-further-to-the-hearing-stage-is-rare-most-tickets-are-either-not-contested-or-got-resolved-earlier-the-large-number-of-missing-values-make-sense." class="level1">
<h1>Hearing_disposition has a missing vlaue of 259899, given that the contested tickets that got taken to the court and make it further to the hearing stage is rare, most tickets are either not contested or got resolved earlier, the large number of missing values make sense.</h1>
</section>
<section id="notice_level-has-a-missing-value-of-84068-given-that-this-column-measures-the-tickets-number-that-reaches-the-final-stage-i.e.-breaching-violating-the-tickets-that-are-paid-off-or-dismissed-takes-up-the-majority-of-all-tickets-which-justify-the-large-number-of-na." class="level1">
<h1>Notice_level has a missing value of 84068, given that this column measures the tickets number that reaches the final stage (i.e.&nbsp;breaching, violating), the tickets that are paid off or dismissed takes up the majority of all tickets, which justify the large number of na.</h1>
</section>
<section id="zipcode-takes-up-54115-missing-values-this-is-due-to-the-data-collection-process-given-the-limitation-of-technology-to-track-to-location-of-entries." class="level1">
<h1>zipcode takes up 54115 missing values, this is due to the data collection process, given the limitation of technology to track to location of entries.</h1>
</section>
<section id="q3" class="level1">
<h1>Q3</h1>
<div id="e7522243" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bs4</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">'https://www.chicago.gov/city/en/depts/fin/provdrs/parking_and_redlightcitationadministration/supp_info/ParkingStandingandComplianceViolations.html'</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>seed <span class="op">=</span> requests.get(url)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(seed.text, <span class="st">'html.parser'</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> soup.find(<span class="st">'table'</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> table.find_all(<span class="st">'tr'</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> rows:</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract columns for each row</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> row.find_all(<span class="st">'td'</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    cols_text <span class="op">=</span> [col.text.strip() <span class="cf">for</span> col <span class="kw">in</span> cols]</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if any column contains the word 'sticker'</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">any</span>(<span class="st">'sticker'</span> <span class="kw">in</span> col.lower() <span class="cf">for</span> col <span class="kw">in</span> cols_text):</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(cols_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['9-64-125(b)', 'No City Sticker Vehicle Under/Equal to 16,000 LBS', '$200.00', '$50.00']
['9-64-125(c)', 'No City Sticker Vehicle Over 16,000 LBS', '$250.00', '$0.00']
['9-64-125(d)', 'Improper Display of City Sticker', '$30.00', '$30.00']</code></pre>
</div>
</div>
</section>
<section id="by-scraping-the-table-we-have-code-9-64-125-for-old-sticker-misplacement-or-missing-as-the-violation-code-the-new-violation-code-is-code-9-64-125b-which-differentiate-the-penalities-by-the-weight-of-vehicle" class="level1">
<h1>By scraping the table, we have Code 9-64-125 for old sticker misplacement or missing as the violation code, the new violation code is Code 9-64-125(b), which differentiate the penalities by the weight of vehicle</h1>
</section>
<section id="q4" class="level1">
<h1>Q4</h1>
<div id="416e27f4" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">'https://www.propublica.org/article/chicago-vehicle-sticker-law-ticket-price-hike-black-drivers-debt'</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>seed <span class="op">=</span> requests.get(url)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(seed.text, <span class="st">'html.parser'</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>paragraphs <span class="op">=</span> soup.find_all(<span class="st">'p'</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> soup.get_text()</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>numbers <span class="op">=</span> re.findall(<span class="vs">r'\b\d+\b'</span>, text)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># locate all the numbers in the same line with buzz words like "violation", "fine"</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> paragraphs:</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> p.get_text()</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"violation"</span> <span class="kw">in</span> text.lower() <span class="kw">or</span> <span class="st">"code"</span> <span class="kw">in</span> text.lower() <span class="kw">or</span> <span class="st">"sticker"</span> <span class="kw">in</span> text.lower() <span class="kw">and</span> <span class="st">"budget"</span> <span class="kw">in</span> text.lower():</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(text)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Find and print numbers in the paragraph</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        paragraph_numbers <span class="op">=</span> re.findall(<span class="vs">r'\b\d+\b'</span>, text)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> paragraph_numbers:</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Numbers found: </span><span class="sc">{</span>paragraph_numbers<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>During negotiations for Chicago’s 2012 budget, newly elected Mayor Rahm Emanuel and then-City Clerk Susana Mendoza agreed to hike the price of what was already one of the priciest tickets vehicle owners can get in the city. Citations for not having a required vehicle sticker rose from $120 to $200.
Numbers found: ['2012', '120', '200']
She suggested instead that the city raise penalties for sticker “scofflaws.” Aldermen applauded her strategy and the Emanuel administration went along. The increase was included in the broader vote on the city budget, which the City Council unanimously approved.
In an interview, Mendoza said the final sticker ticket price “was based on the fact that the increase in the sticker itself would be marginal and that the money would be made up more so on the noncompliance side. They needed to come up with the revenues for the city at that time to fill that budget hole.”</code></pre>
</div>
</div>
</section>
<section id="after-anchoring-for-key-words-like-violation-and-sticker-we-can-locate-the-paragraph-which-indicates-that-the-old-sticker-price-and-the-new-are-120-and-200-or-250-depending-on-the-weight-but-we-dont-have-to-worry-about-that-respectively." class="level1">
<h1>After anchoring for key words like “violation” and “sticker”, we can locate the paragraph which indicates that the old sticker price and the new are 120 and 200 (or 250, depending on the weight, but we don’t have to worry about that) respectively.</h1>
</section>
<section id="revenue-increase-from-missing-city-sticker-tickets" class="level1">
<h1>Revenue increase from “missing city sticker” tickets</h1>
</section>
<section id="q1" class="level1">
<h1>Q1</h1>
<div id="df98b769" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#check the format</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'violation_code'</span>].unique()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>df.head()</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># the codes are stored as numeric value instead of string, so no "-" or "()" are shown as denoted in the official website</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 0964125', '0964125B are not combined in one value "0964125_combined"</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> combine_violation_codes(code):</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> code <span class="kw">in</span> [<span class="st">'0964125'</span>, <span class="st">'0964125B'</span>]:</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'0964125_combined'</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> code</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'violation_code_combined'</span>] <span class="op">=</span> df[<span class="st">'violation_code'</span>].<span class="bu">apply</span>(combine_violation_codes)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>df.head()</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Now collapse the new created value, first we need to convert datatime format</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'issue_date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'issue_date'</span>])</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>df_sticker <span class="op">=</span> df[df[<span class="st">'violation_code_combined'</span>] <span class="op">==</span> <span class="st">'0964125_combined'</span>]</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>monthly_ticket <span class="op">=</span> df_sticker.resample(<span class="st">'M'</span>, on<span class="op">=</span><span class="st">'issue_date'</span>).size().reset_index(name<span class="op">=</span><span class="st">'count_of_combined_violations'</span>) <span class="co">#group by monthes</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (monthly_ticket)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co">#ALtiar plotting</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> alt.Chart(monthly_ticket).mark_line().encode(</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'issue_date:T'</span>,  <span class="co"># Time on the x-axis from 'monthly_ticket'</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'count_of_combined_violations:Q'</span>,  <span class="co"># Quantitative count on the y-axis from 'monthly_ticket'</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'issue_date:T'</span>, <span class="st">'count_of_combined_violations:Q'</span>]  <span class="co"># Tooltip for more details on hover</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Number of Combined Violation Tickets Over Time'</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>chart.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    issue_date  count_of_combined_violations
0   2007-01-31                           160
1   2007-02-28                           104
2   2007-03-31                           161
3   2007-04-30                           158
4   2007-05-31                           126
..         ...                           ...
132 2018-01-31                           168
133 2018-02-28                           119
134 2018-03-31                           171
135 2018-04-30                           153
136 2018-05-31                            79

[137 rows x 2 columns]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/b0/6kybjmv57sv8drq7v4kr7w240000gn/T/ipykernel_2628/1938627337.py:20: FutureWarning: 'M' is deprecated and will be removed in a future version, please use 'ME' instead.
  monthly_ticket = df_sticker.resample('M', on='issue_date').size().reset_index(name='count_of_combined_violations') #group by monthes</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
  #altair-viz-4aee1be41e4341a59090654fab941e75.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-4aee1be41e4341a59090654fab941e75.vega-embed details,
  #altair-viz-4aee1be41e4341a59090654fab941e75.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-4aee1be41e4341a59090654fab941e75"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-4aee1be41e4341a59090654fab941e75") {
      outputDiv = document.getElementById("altair-viz-4aee1be41e4341a59090654fab941e75");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-d08838d0292fd0bd126a1a977f3e2a2a"}, "mark": {"type": "line"}, "encoding": {"tooltip": [{"field": "issue_date", "type": "temporal"}, {"field": "count_of_combined_violations", "type": "quantitative"}], "x": {"field": "issue_date", "type": "temporal"}, "y": {"field": "count_of_combined_violations", "type": "quantitative"}}, "title": "Number of Combined Violation Tickets Over Time", "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-d08838d0292fd0bd126a1a977f3e2a2a": [{"issue_date": "2007-01-31T00:00:00", "count_of_combined_violations": 160}, {"issue_date": "2007-02-28T00:00:00", "count_of_combined_violations": 104}, {"issue_date": "2007-03-31T00:00:00", "count_of_combined_violations": 161}, {"issue_date": "2007-04-30T00:00:00", "count_of_combined_violations": 158}, {"issue_date": "2007-05-31T00:00:00", "count_of_combined_violations": 126}, {"issue_date": "2007-06-30T00:00:00", "count_of_combined_violations": 80}, {"issue_date": "2007-07-31T00:00:00", "count_of_combined_violations": 399}, {"issue_date": "2007-08-31T00:00:00", "count_of_combined_violations": 345}, {"issue_date": "2007-09-30T00:00:00", "count_of_combined_violations": 224}, {"issue_date": "2007-10-31T00:00:00", "count_of_combined_violations": 221}, {"issue_date": "2007-11-30T00:00:00", "count_of_combined_violations": 168}, {"issue_date": "2007-12-31T00:00:00", "count_of_combined_violations": 118}, {"issue_date": "2008-01-31T00:00:00", "count_of_combined_violations": 132}, {"issue_date": "2008-02-29T00:00:00", "count_of_combined_violations": 149}, {"issue_date": "2008-03-31T00:00:00", "count_of_combined_violations": 192}, {"issue_date": "2008-04-30T00:00:00", "count_of_combined_violations": 166}, {"issue_date": "2008-05-31T00:00:00", "count_of_combined_violations": 139}, {"issue_date": "2008-06-30T00:00:00", "count_of_combined_violations": 72}, {"issue_date": "2008-07-31T00:00:00", "count_of_combined_violations": 382}, {"issue_date": "2008-08-31T00:00:00", "count_of_combined_violations": 342}, {"issue_date": "2008-09-30T00:00:00", "count_of_combined_violations": 213}, {"issue_date": "2008-10-31T00:00:00", "count_of_combined_violations": 197}, {"issue_date": "2008-11-30T00:00:00", "count_of_combined_violations": 148}, {"issue_date": "2008-12-31T00:00:00", "count_of_combined_violations": 80}, {"issue_date": "2009-01-31T00:00:00", "count_of_combined_violations": 81}, {"issue_date": "2009-02-28T00:00:00", "count_of_combined_violations": 121}, {"issue_date": "2009-03-31T00:00:00", "count_of_combined_violations": 171}, {"issue_date": "2009-04-30T00:00:00", "count_of_combined_violations": 149}, {"issue_date": "2009-05-31T00:00:00", "count_of_combined_violations": 132}, {"issue_date": "2009-06-30T00:00:00", "count_of_combined_violations": 89}, {"issue_date": "2009-07-31T00:00:00", "count_of_combined_violations": 392}, {"issue_date": "2009-08-31T00:00:00", "count_of_combined_violations": 347}, {"issue_date": "2009-09-30T00:00:00", "count_of_combined_violations": 211}, {"issue_date": "2009-10-31T00:00:00", "count_of_combined_violations": 188}, {"issue_date": "2009-11-30T00:00:00", "count_of_combined_violations": 170}, {"issue_date": "2009-12-31T00:00:00", "count_of_combined_violations": 98}, {"issue_date": "2010-01-31T00:00:00", "count_of_combined_violations": 156}, {"issue_date": "2010-02-28T00:00:00", "count_of_combined_violations": 129}, {"issue_date": "2010-03-31T00:00:00", "count_of_combined_violations": 153}, {"issue_date": "2010-04-30T00:00:00", "count_of_combined_violations": 138}, {"issue_date": "2010-05-31T00:00:00", "count_of_combined_violations": 140}, {"issue_date": "2010-06-30T00:00:00", "count_of_combined_violations": 99}, {"issue_date": "2010-07-31T00:00:00", "count_of_combined_violations": 26}, {"issue_date": "2010-08-31T00:00:00", "count_of_combined_violations": 425}, {"issue_date": "2010-09-30T00:00:00", "count_of_combined_violations": 237}, {"issue_date": "2010-10-31T00:00:00", "count_of_combined_violations": 197}, {"issue_date": "2010-11-30T00:00:00", "count_of_combined_violations": 168}, {"issue_date": "2010-12-31T00:00:00", "count_of_combined_violations": 117}, {"issue_date": "2011-01-31T00:00:00", "count_of_combined_violations": 153}, {"issue_date": "2011-02-28T00:00:00", "count_of_combined_violations": 87}, {"issue_date": "2011-03-31T00:00:00", "count_of_combined_violations": 147}, {"issue_date": "2011-04-30T00:00:00", "count_of_combined_violations": 135}, {"issue_date": "2011-05-31T00:00:00", "count_of_combined_violations": 134}, {"issue_date": "2011-06-30T00:00:00", "count_of_combined_violations": 78}, {"issue_date": "2011-07-31T00:00:00", "count_of_combined_violations": 317}, {"issue_date": "2011-08-31T00:00:00", "count_of_combined_violations": 313}, {"issue_date": "2011-09-30T00:00:00", "count_of_combined_violations": 171}, {"issue_date": "2011-10-31T00:00:00", "count_of_combined_violations": 136}, {"issue_date": "2011-11-30T00:00:00", "count_of_combined_violations": 139}, {"issue_date": "2011-12-31T00:00:00", "count_of_combined_violations": 123}, {"issue_date": "2012-01-31T00:00:00", "count_of_combined_violations": 114}, {"issue_date": "2012-02-29T00:00:00", "count_of_combined_violations": 138}, {"issue_date": "2012-03-31T00:00:00", "count_of_combined_violations": 181}, {"issue_date": "2012-04-30T00:00:00", "count_of_combined_violations": 142}, {"issue_date": "2012-05-31T00:00:00", "count_of_combined_violations": 115}, {"issue_date": "2012-06-30T00:00:00", "count_of_combined_violations": 100}, {"issue_date": "2012-07-31T00:00:00", "count_of_combined_violations": 414}, {"issue_date": "2012-08-31T00:00:00", "count_of_combined_violations": 319}, {"issue_date": "2012-09-30T00:00:00", "count_of_combined_violations": 179}, {"issue_date": "2012-10-31T00:00:00", "count_of_combined_violations": 171}, {"issue_date": "2012-11-30T00:00:00", "count_of_combined_violations": 157}, {"issue_date": "2012-12-31T00:00:00", "count_of_combined_violations": 162}, {"issue_date": "2013-01-31T00:00:00", "count_of_combined_violations": 196}, {"issue_date": "2013-02-28T00:00:00", "count_of_combined_violations": 158}, {"issue_date": "2013-03-31T00:00:00", "count_of_combined_violations": 199}, {"issue_date": "2013-04-30T00:00:00", "count_of_combined_violations": 187}, {"issue_date": "2013-05-31T00:00:00", "count_of_combined_violations": 179}, {"issue_date": "2013-06-30T00:00:00", "count_of_combined_violations": 140}, {"issue_date": "2013-07-31T00:00:00", "count_of_combined_violations": 499}, {"issue_date": "2013-08-31T00:00:00", "count_of_combined_violations": 355}, {"issue_date": "2013-09-30T00:00:00", "count_of_combined_violations": 221}, {"issue_date": "2013-10-31T00:00:00", "count_of_combined_violations": 208}, {"issue_date": "2013-11-30T00:00:00", "count_of_combined_violations": 127}, {"issue_date": "2013-12-31T00:00:00", "count_of_combined_violations": 98}, {"issue_date": "2014-01-31T00:00:00", "count_of_combined_violations": 100}, {"issue_date": "2014-02-28T00:00:00", "count_of_combined_violations": 147}, {"issue_date": "2014-03-31T00:00:00", "count_of_combined_violations": 155}, {"issue_date": "2014-04-30T00:00:00", "count_of_combined_violations": 144}, {"issue_date": "2014-05-31T00:00:00", "count_of_combined_violations": 178}, {"issue_date": "2014-06-30T00:00:00", "count_of_combined_violations": 116}, {"issue_date": "2014-07-31T00:00:00", "count_of_combined_violations": 267}, {"issue_date": "2014-08-31T00:00:00", "count_of_combined_violations": 245}, {"issue_date": "2014-09-30T00:00:00", "count_of_combined_violations": 178}, {"issue_date": "2014-10-31T00:00:00", "count_of_combined_violations": 165}, {"issue_date": "2014-11-30T00:00:00", "count_of_combined_violations": 153}, {"issue_date": "2014-12-31T00:00:00", "count_of_combined_violations": 177}, {"issue_date": "2015-01-31T00:00:00", "count_of_combined_violations": 179}, {"issue_date": "2015-02-28T00:00:00", "count_of_combined_violations": 142}, {"issue_date": "2015-03-31T00:00:00", "count_of_combined_violations": 223}, {"issue_date": "2015-04-30T00:00:00", "count_of_combined_violations": 191}, {"issue_date": "2015-05-31T00:00:00", "count_of_combined_violations": 191}, {"issue_date": "2015-06-30T00:00:00", "count_of_combined_violations": 198}, {"issue_date": "2015-07-31T00:00:00", "count_of_combined_violations": 217}, {"issue_date": "2015-08-31T00:00:00", "count_of_combined_violations": 210}, {"issue_date": "2015-09-30T00:00:00", "count_of_combined_violations": 225}, {"issue_date": "2015-10-31T00:00:00", "count_of_combined_violations": 245}, {"issue_date": "2015-11-30T00:00:00", "count_of_combined_violations": 226}, {"issue_date": "2015-12-31T00:00:00", "count_of_combined_violations": 220}, {"issue_date": "2016-01-31T00:00:00", "count_of_combined_violations": 202}, {"issue_date": "2016-02-29T00:00:00", "count_of_combined_violations": 206}, {"issue_date": "2016-03-31T00:00:00", "count_of_combined_violations": 241}, {"issue_date": "2016-04-30T00:00:00", "count_of_combined_violations": 203}, {"issue_date": "2016-05-31T00:00:00", "count_of_combined_violations": 185}, {"issue_date": "2016-06-30T00:00:00", "count_of_combined_violations": 175}, {"issue_date": "2016-07-31T00:00:00", "count_of_combined_violations": 160}, {"issue_date": "2016-08-31T00:00:00", "count_of_combined_violations": 151}, {"issue_date": "2016-09-30T00:00:00", "count_of_combined_violations": 183}, {"issue_date": "2016-10-31T00:00:00", "count_of_combined_violations": 220}, {"issue_date": "2016-11-30T00:00:00", "count_of_combined_violations": 182}, {"issue_date": "2016-12-31T00:00:00", "count_of_combined_violations": 156}, {"issue_date": "2017-01-31T00:00:00", "count_of_combined_violations": 238}, {"issue_date": "2017-02-28T00:00:00", "count_of_combined_violations": 190}, {"issue_date": "2017-03-31T00:00:00", "count_of_combined_violations": 211}, {"issue_date": "2017-04-30T00:00:00", "count_of_combined_violations": 191}, {"issue_date": "2017-05-31T00:00:00", "count_of_combined_violations": 192}, {"issue_date": "2017-06-30T00:00:00", "count_of_combined_violations": 177}, {"issue_date": "2017-07-31T00:00:00", "count_of_combined_violations": 166}, {"issue_date": "2017-08-31T00:00:00", "count_of_combined_violations": 173}, {"issue_date": "2017-09-30T00:00:00", "count_of_combined_violations": 188}, {"issue_date": "2017-10-31T00:00:00", "count_of_combined_violations": 169}, {"issue_date": "2017-11-30T00:00:00", "count_of_combined_violations": 202}, {"issue_date": "2017-12-31T00:00:00", "count_of_combined_violations": 159}, {"issue_date": "2018-01-31T00:00:00", "count_of_combined_violations": 168}, {"issue_date": "2018-02-28T00:00:00", "count_of_combined_violations": 119}, {"issue_date": "2018-03-31T00:00:00", "count_of_combined_violations": 171}, {"issue_date": "2018-04-30T00:00:00", "count_of_combined_violations": 153}, {"issue_date": "2018-05-31T00:00:00", "count_of_combined_violations": 79}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="q2" class="level1">
<h1>Q2</h1>
</section>
<section id="after-reseraching-stack-overflow-the-relevant-help-page-is-altair-axis-document.-we-are-essentially-creatnig-another-altair-chart-with-a-more-precise-x-axis-label" class="level1">
<h1>after reseraching stack overflow, the relevant help page is Altair Axis Document. We are essentially creatnig another altair chart with a more precise x-axis label</h1>
<div id="0edc348c" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an Altair line chart with customized x-axis date labels</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> alt.Chart(monthly_ticket).mark_line().encode(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'issue_date:T'</span>, </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>            axis<span class="op">=</span>alt.Axis(</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                <span class="bu">format</span><span class="op">=</span><span class="st">'%Y-%m'</span>,  <span class="co">#high light Year-Month</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                labelAngle<span class="op">=-</span><span class="dv">45</span>,  <span class="co"># rotate labels for better fit</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                tickCount<span class="op">=</span><span class="st">'month'</span>  </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>            )),</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'count_of_combined_violations:Q'</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'issue_date:T'</span>, <span class="st">'count_of_combined_violations:Q'</span>]</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Number of Combined Violation Tickets Over Time with Custom Date Labels'</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>chart.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
  #altair-viz-257254a8676942ecaaddf5f734c05866.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-257254a8676942ecaaddf5f734c05866.vega-embed details,
  #altair-viz-257254a8676942ecaaddf5f734c05866.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-257254a8676942ecaaddf5f734c05866"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-257254a8676942ecaaddf5f734c05866") {
      outputDiv = document.getElementById("altair-viz-257254a8676942ecaaddf5f734c05866");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-d08838d0292fd0bd126a1a977f3e2a2a"}, "mark": {"type": "line"}, "encoding": {"tooltip": [{"field": "issue_date", "type": "temporal"}, {"field": "count_of_combined_violations", "type": "quantitative"}], "x": {"axis": {"format": "%Y-%m", "labelAngle": -45, "tickCount": "month"}, "field": "issue_date", "type": "temporal"}, "y": {"field": "count_of_combined_violations", "type": "quantitative"}}, "title": "Number of Combined Violation Tickets Over Time with Custom Date Labels", "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-d08838d0292fd0bd126a1a977f3e2a2a": [{"issue_date": "2007-01-31T00:00:00", "count_of_combined_violations": 160}, {"issue_date": "2007-02-28T00:00:00", "count_of_combined_violations": 104}, {"issue_date": "2007-03-31T00:00:00", "count_of_combined_violations": 161}, {"issue_date": "2007-04-30T00:00:00", "count_of_combined_violations": 158}, {"issue_date": "2007-05-31T00:00:00", "count_of_combined_violations": 126}, {"issue_date": "2007-06-30T00:00:00", "count_of_combined_violations": 80}, {"issue_date": "2007-07-31T00:00:00", "count_of_combined_violations": 399}, {"issue_date": "2007-08-31T00:00:00", "count_of_combined_violations": 345}, {"issue_date": "2007-09-30T00:00:00", "count_of_combined_violations": 224}, {"issue_date": "2007-10-31T00:00:00", "count_of_combined_violations": 221}, {"issue_date": "2007-11-30T00:00:00", "count_of_combined_violations": 168}, {"issue_date": "2007-12-31T00:00:00", "count_of_combined_violations": 118}, {"issue_date": "2008-01-31T00:00:00", "count_of_combined_violations": 132}, {"issue_date": "2008-02-29T00:00:00", "count_of_combined_violations": 149}, {"issue_date": "2008-03-31T00:00:00", "count_of_combined_violations": 192}, {"issue_date": "2008-04-30T00:00:00", "count_of_combined_violations": 166}, {"issue_date": "2008-05-31T00:00:00", "count_of_combined_violations": 139}, {"issue_date": "2008-06-30T00:00:00", "count_of_combined_violations": 72}, {"issue_date": "2008-07-31T00:00:00", "count_of_combined_violations": 382}, {"issue_date": "2008-08-31T00:00:00", "count_of_combined_violations": 342}, {"issue_date": "2008-09-30T00:00:00", "count_of_combined_violations": 213}, {"issue_date": "2008-10-31T00:00:00", "count_of_combined_violations": 197}, {"issue_date": "2008-11-30T00:00:00", "count_of_combined_violations": 148}, {"issue_date": "2008-12-31T00:00:00", "count_of_combined_violations": 80}, {"issue_date": "2009-01-31T00:00:00", "count_of_combined_violations": 81}, {"issue_date": "2009-02-28T00:00:00", "count_of_combined_violations": 121}, {"issue_date": "2009-03-31T00:00:00", "count_of_combined_violations": 171}, {"issue_date": "2009-04-30T00:00:00", "count_of_combined_violations": 149}, {"issue_date": "2009-05-31T00:00:00", "count_of_combined_violations": 132}, {"issue_date": "2009-06-30T00:00:00", "count_of_combined_violations": 89}, {"issue_date": "2009-07-31T00:00:00", "count_of_combined_violations": 392}, {"issue_date": "2009-08-31T00:00:00", "count_of_combined_violations": 347}, {"issue_date": "2009-09-30T00:00:00", "count_of_combined_violations": 211}, {"issue_date": "2009-10-31T00:00:00", "count_of_combined_violations": 188}, {"issue_date": "2009-11-30T00:00:00", "count_of_combined_violations": 170}, {"issue_date": "2009-12-31T00:00:00", "count_of_combined_violations": 98}, {"issue_date": "2010-01-31T00:00:00", "count_of_combined_violations": 156}, {"issue_date": "2010-02-28T00:00:00", "count_of_combined_violations": 129}, {"issue_date": "2010-03-31T00:00:00", "count_of_combined_violations": 153}, {"issue_date": "2010-04-30T00:00:00", "count_of_combined_violations": 138}, {"issue_date": "2010-05-31T00:00:00", "count_of_combined_violations": 140}, {"issue_date": "2010-06-30T00:00:00", "count_of_combined_violations": 99}, {"issue_date": "2010-07-31T00:00:00", "count_of_combined_violations": 26}, {"issue_date": "2010-08-31T00:00:00", "count_of_combined_violations": 425}, {"issue_date": "2010-09-30T00:00:00", "count_of_combined_violations": 237}, {"issue_date": "2010-10-31T00:00:00", "count_of_combined_violations": 197}, {"issue_date": "2010-11-30T00:00:00", "count_of_combined_violations": 168}, {"issue_date": "2010-12-31T00:00:00", "count_of_combined_violations": 117}, {"issue_date": "2011-01-31T00:00:00", "count_of_combined_violations": 153}, {"issue_date": "2011-02-28T00:00:00", "count_of_combined_violations": 87}, {"issue_date": "2011-03-31T00:00:00", "count_of_combined_violations": 147}, {"issue_date": "2011-04-30T00:00:00", "count_of_combined_violations": 135}, {"issue_date": "2011-05-31T00:00:00", "count_of_combined_violations": 134}, {"issue_date": "2011-06-30T00:00:00", "count_of_combined_violations": 78}, {"issue_date": "2011-07-31T00:00:00", "count_of_combined_violations": 317}, {"issue_date": "2011-08-31T00:00:00", "count_of_combined_violations": 313}, {"issue_date": "2011-09-30T00:00:00", "count_of_combined_violations": 171}, {"issue_date": "2011-10-31T00:00:00", "count_of_combined_violations": 136}, {"issue_date": "2011-11-30T00:00:00", "count_of_combined_violations": 139}, {"issue_date": "2011-12-31T00:00:00", "count_of_combined_violations": 123}, {"issue_date": "2012-01-31T00:00:00", "count_of_combined_violations": 114}, {"issue_date": "2012-02-29T00:00:00", "count_of_combined_violations": 138}, {"issue_date": "2012-03-31T00:00:00", "count_of_combined_violations": 181}, {"issue_date": "2012-04-30T00:00:00", "count_of_combined_violations": 142}, {"issue_date": "2012-05-31T00:00:00", "count_of_combined_violations": 115}, {"issue_date": "2012-06-30T00:00:00", "count_of_combined_violations": 100}, {"issue_date": "2012-07-31T00:00:00", "count_of_combined_violations": 414}, {"issue_date": "2012-08-31T00:00:00", "count_of_combined_violations": 319}, {"issue_date": "2012-09-30T00:00:00", "count_of_combined_violations": 179}, {"issue_date": "2012-10-31T00:00:00", "count_of_combined_violations": 171}, {"issue_date": "2012-11-30T00:00:00", "count_of_combined_violations": 157}, {"issue_date": "2012-12-31T00:00:00", "count_of_combined_violations": 162}, {"issue_date": "2013-01-31T00:00:00", "count_of_combined_violations": 196}, {"issue_date": "2013-02-28T00:00:00", "count_of_combined_violations": 158}, {"issue_date": "2013-03-31T00:00:00", "count_of_combined_violations": 199}, {"issue_date": "2013-04-30T00:00:00", "count_of_combined_violations": 187}, {"issue_date": "2013-05-31T00:00:00", "count_of_combined_violations": 179}, {"issue_date": "2013-06-30T00:00:00", "count_of_combined_violations": 140}, {"issue_date": "2013-07-31T00:00:00", "count_of_combined_violations": 499}, {"issue_date": "2013-08-31T00:00:00", "count_of_combined_violations": 355}, {"issue_date": "2013-09-30T00:00:00", "count_of_combined_violations": 221}, {"issue_date": "2013-10-31T00:00:00", "count_of_combined_violations": 208}, {"issue_date": "2013-11-30T00:00:00", "count_of_combined_violations": 127}, {"issue_date": "2013-12-31T00:00:00", "count_of_combined_violations": 98}, {"issue_date": "2014-01-31T00:00:00", "count_of_combined_violations": 100}, {"issue_date": "2014-02-28T00:00:00", "count_of_combined_violations": 147}, {"issue_date": "2014-03-31T00:00:00", "count_of_combined_violations": 155}, {"issue_date": "2014-04-30T00:00:00", "count_of_combined_violations": 144}, {"issue_date": "2014-05-31T00:00:00", "count_of_combined_violations": 178}, {"issue_date": "2014-06-30T00:00:00", "count_of_combined_violations": 116}, {"issue_date": "2014-07-31T00:00:00", "count_of_combined_violations": 267}, {"issue_date": "2014-08-31T00:00:00", "count_of_combined_violations": 245}, {"issue_date": "2014-09-30T00:00:00", "count_of_combined_violations": 178}, {"issue_date": "2014-10-31T00:00:00", "count_of_combined_violations": 165}, {"issue_date": "2014-11-30T00:00:00", "count_of_combined_violations": 153}, {"issue_date": "2014-12-31T00:00:00", "count_of_combined_violations": 177}, {"issue_date": "2015-01-31T00:00:00", "count_of_combined_violations": 179}, {"issue_date": "2015-02-28T00:00:00", "count_of_combined_violations": 142}, {"issue_date": "2015-03-31T00:00:00", "count_of_combined_violations": 223}, {"issue_date": "2015-04-30T00:00:00", "count_of_combined_violations": 191}, {"issue_date": "2015-05-31T00:00:00", "count_of_combined_violations": 191}, {"issue_date": "2015-06-30T00:00:00", "count_of_combined_violations": 198}, {"issue_date": "2015-07-31T00:00:00", "count_of_combined_violations": 217}, {"issue_date": "2015-08-31T00:00:00", "count_of_combined_violations": 210}, {"issue_date": "2015-09-30T00:00:00", "count_of_combined_violations": 225}, {"issue_date": "2015-10-31T00:00:00", "count_of_combined_violations": 245}, {"issue_date": "2015-11-30T00:00:00", "count_of_combined_violations": 226}, {"issue_date": "2015-12-31T00:00:00", "count_of_combined_violations": 220}, {"issue_date": "2016-01-31T00:00:00", "count_of_combined_violations": 202}, {"issue_date": "2016-02-29T00:00:00", "count_of_combined_violations": 206}, {"issue_date": "2016-03-31T00:00:00", "count_of_combined_violations": 241}, {"issue_date": "2016-04-30T00:00:00", "count_of_combined_violations": 203}, {"issue_date": "2016-05-31T00:00:00", "count_of_combined_violations": 185}, {"issue_date": "2016-06-30T00:00:00", "count_of_combined_violations": 175}, {"issue_date": "2016-07-31T00:00:00", "count_of_combined_violations": 160}, {"issue_date": "2016-08-31T00:00:00", "count_of_combined_violations": 151}, {"issue_date": "2016-09-30T00:00:00", "count_of_combined_violations": 183}, {"issue_date": "2016-10-31T00:00:00", "count_of_combined_violations": 220}, {"issue_date": "2016-11-30T00:00:00", "count_of_combined_violations": 182}, {"issue_date": "2016-12-31T00:00:00", "count_of_combined_violations": 156}, {"issue_date": "2017-01-31T00:00:00", "count_of_combined_violations": 238}, {"issue_date": "2017-02-28T00:00:00", "count_of_combined_violations": 190}, {"issue_date": "2017-03-31T00:00:00", "count_of_combined_violations": 211}, {"issue_date": "2017-04-30T00:00:00", "count_of_combined_violations": 191}, {"issue_date": "2017-05-31T00:00:00", "count_of_combined_violations": 192}, {"issue_date": "2017-06-30T00:00:00", "count_of_combined_violations": 177}, {"issue_date": "2017-07-31T00:00:00", "count_of_combined_violations": 166}, {"issue_date": "2017-08-31T00:00:00", "count_of_combined_violations": 173}, {"issue_date": "2017-09-30T00:00:00", "count_of_combined_violations": 188}, {"issue_date": "2017-10-31T00:00:00", "count_of_combined_violations": 169}, {"issue_date": "2017-11-30T00:00:00", "count_of_combined_violations": 202}, {"issue_date": "2017-12-31T00:00:00", "count_of_combined_violations": 159}, {"issue_date": "2018-01-31T00:00:00", "count_of_combined_violations": 168}, {"issue_date": "2018-02-28T00:00:00", "count_of_combined_violations": 119}, {"issue_date": "2018-03-31T00:00:00", "count_of_combined_violations": 171}, {"issue_date": "2018-04-30T00:00:00", "count_of_combined_violations": 153}, {"issue_date": "2018-05-31T00:00:00", "count_of_combined_violations": 79}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<p>Q3 # Given that the increase in the penality happen in year 2012, the increase in revenue for each ticket is 80 dollars (200 - 120), and the sample is 1% of the population, we can calculate the following. The increase in revenue should be $15,360,000</p>
<div id="51da20dd" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Given the increase in the vehicle city sticker violation fine in Chicago occurred in 2012, we would first need to set the cut-off and filter data</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>year_begin <span class="op">=</span> <span class="st">'2011-02-24'</span>  </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>Year_end <span class="op">=</span> <span class="st">'2012-02-24'</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>df_before_after <span class="op">=</span> df_sticker[(df_sticker[<span class="st">'issue_date'</span>] <span class="op">&gt;=</span> year_begin) <span class="op">&amp;</span> (df_sticker[<span class="st">'issue_date'</span>] <span class="op">&lt;=</span> Year_end)]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#we then count the number in the filter data</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>tickets_1p <span class="op">=</span> df_before_after.shape[<span class="dv">0</span>]</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># scale up by 100 to infer population tickets</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>tickets_100p <span class="op">=</span> tickets_1p <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># The increase in price is 200-120 = 80</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>revenue_increase <span class="op">=</span> tickets_100p <span class="op">*</span> <span class="dv">80</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Revenue increase from new penality is $</span><span class="sc">{</span>revenue_increase<span class="sc">:,}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Revenue increase from new penality is $15,360,000</code></pre>
</div>
</div>
</section>
<section id="q4-1" class="level1">
<h1>Q4</h1>
</section>
<section id="the-wording-of-this-question-is-a-little-vague-but-from-what-i-understand-the-denominator-of-the-repayment-rate-is-the-number-of-tickets-with-both-some-partial-payments-and-those-that-are-paid-up.-the-following-operation-is-base-on-this-assumption." class="level1">
<h1>The wording of this question is a little vague, but from what i understand, the denominator of the repayment rate is the numbeR of tickets with both some partial payments and those that are paid up. The following operation is base on this assumption.</h1>
</section>
<section id="the-repayment-rate-drops-from-49.08-to-43.37." class="level1">
<h1>The repayment rate drops from 49.08% to 43.37%.</h1>
<div id="1b253bb2" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter tickets between 2012-02-25 and 2013-02-25</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>year_after <span class="op">=</span> df_sticker[(df_sticker[<span class="st">'issue_date'</span>].dt.date.between(pd.to_datetime(<span class="st">'2012-02-25'</span>).date(), pd.to_datetime(<span class="st">'2013-02-25'</span>).date()))]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># For year_1 (2012)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>paid_ticket_1 <span class="op">=</span> year_after[year_after[<span class="st">'total_payments'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]  <span class="co"># filter tickets with payments made</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>total_tickets_after <span class="op">=</span> year_after[<span class="st">'ticket_number'</span>].nunique()  <span class="co"># total tickets issued before increase in penalty</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>total_paid_tickets_after <span class="op">=</span> paid_ticket_1[<span class="st">'ticket_number'</span>].nunique()  <span class="co"># total paid tickets</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>repayment_rate_after <span class="op">=</span> total_paid_tickets_after <span class="op">/</span> total_tickets_after  <span class="co"># repayment rate</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print repayment rates</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Repayment Rate for 2012-13 (After Price Increase): </span><span class="sc">{</span>repayment_rate_after <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%"</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co"># For year_0 (2011)</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>year_before <span class="op">=</span> df_sticker[(df_sticker[<span class="st">'issue_date'</span>].dt.date.between(pd.to_datetime(<span class="st">'2011-02-25'</span>).date(), pd.to_datetime(<span class="st">'2012-02-25'</span>).date()))]</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>paid_ticket_0 <span class="op">=</span> year_before[year_before[<span class="st">'total_payments'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>total_tickets_before <span class="op">=</span> year_before[<span class="st">'ticket_number'</span>].nunique() </span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>total_paid_tickets_before <span class="op">=</span> paid_ticket_0[<span class="st">'ticket_number'</span>].nunique()</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>repayment_rate_before <span class="op">=</span> total_paid_tickets_before <span class="op">/</span> total_tickets_before</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Repayment Rate for 2011-12 (After Price Increase): </span><span class="sc">{</span>repayment_rate_before <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Repayment Rate for 2012-13 (After Price Increase): 43.74%
Repayment Rate for 2011-12 (After Price Increase): 49.08%</code></pre>
</div>
</div>
</section>
<section id="q5" class="level1">
<h1>Q5</h1>
</section>
<section id="as-shown-in-the-graph-there-is-a-clear-decline-following-the-policy-change-marked-by-the-red-vertical-line-on-february-15-2012.-before-the-policy-repayment-rates-hovered-around-55-but-after-2012-there-was-a-significant-drop-with-rates-steadily-decreasing-to-below-20-by-2018.-this-sharp-decline-suggests-that-the-policy-change-likely-involving-a-price-increase-negatively-impacted-peoples-ability-or-willingness-to-pay-resulting-in-much-lower-repayment-rates-over-time." class="level1">
<h1>As shown in the graph, there is a clear decline following the policy change marked by the red vertical line on February 15, 2012. Before the policy, repayment rates hovered around 55%, but after 2012, there was a significant drop, with rates steadily decreasing to below 20% by 2018. This sharp decline suggests that the policy change, likely involving a price increase, negatively impacted people’s ability or willingness to pay, resulting in much lower repayment rates over time.</h1>
</section>
<section id="the-plot-demonstrates-the-imporant-concept-in-class-how-the-scale-of-one-graph-can-be-changed-to-give-different-impressions-to-the-reader.-in-q4-when-i-first-saw-the-numeric-change-in-the-repayment-rate-it-does-not-appear-striking-however-after-adjusting-for-the-scale-of-y-axis.-we-get-this-utterly-steep-curve." class="level1">
<h1>The plot demonstrates the imporant concept in class, how the scale of one graph can be changed to give different impressions to the reader. In Q4, when I first saw the numeric change in the repayment rate, it does not appear striking; however after adjusting for the scale of Y-axis. We get this utterly steep curve.</h1>
<div id="8bb027b9" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data and calculate repayment rates for every year</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df_filtered <span class="op">=</span> df_sticker[(df_sticker[<span class="st">'issue_date'</span>].dt.year <span class="op">&gt;=</span> <span class="dv">2007</span>) <span class="op">&amp;</span> (df_sticker[<span class="st">'issue_date'</span>].dt.year <span class="op">&lt;=</span> <span class="dv">2018</span>)]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>df_filtered[<span class="st">'year'</span>] <span class="op">=</span> df_filtered[<span class="st">'issue_date'</span>].dt.year</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>repayment_rates <span class="op">=</span> df_filtered.groupby(<span class="st">'year'</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: (x[x[<span class="st">'total_payments'</span>] <span class="op">&gt;</span> <span class="dv">0</span>][<span class="st">'ticket_number'</span>].nunique() <span class="op">/</span> x[<span class="st">'ticket_number'</span>].nunique()) <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with connected dots</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>plt.plot(repayment_rates.index, repayment_rates.values, color<span class="op">=</span><span class="st">'lightblue'</span>, marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span><span class="st">'Repayment Rate'</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span><span class="dv">2012</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'Policy Change (Feb 15, 2012)'</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">2006</span>, <span class="dv">2019</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year'</span>)<span class="op">;</span> plt.ylabel(<span class="st">'Repayment Rate (%)'</span>)<span class="op">;</span> plt.title(<span class="st">'Repayment Rates (2007-2018)'</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span> plt.tight_layout()<span class="op">;</span> plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/b0/6kybjmv57sv8drq7v4kr7w240000gn/T/ipykernel_2628/3746950398.py:4: DeprecationWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  repayment_rates = df_filtered.groupby('year').apply(lambda x: (x[x['total_payments'] &gt; 0]['ticket_number'].nunique() / x['ticket_number'].nunique()) * 100)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ps2%20JL_files/figure-html/cell-10-output-2.png" width="662" height="470" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="q6" class="level1">
<h1>Q6</h1>
</section>
<section id="based-on-the-column-ranking-which-represents-the-product-of-repayment-rate-and-the-number-of-ticketsa-simple-measure-that-captures-both-aspects-of-revenue-generationthe-top-three-recommendations-are-expired-plates-or-temporary-registration-parkingstanding-prohibited-anytime-and-rush-hour-parking" class="level1">
<h1>Based on the column ranking, which represents the product of repayment rate and the number of tickets—a simple measure that captures both aspects of revenue generation—the top three recommendations are Expired Plates or Temporary Registration, PARKING/STANDING PROHIBITED ANYTIME and RUSH HOUR PARKING</h1>
<div id="f49959ef" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by violation type, calculate the number of tickets and repayment rate for each</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df_grouped <span class="op">=</span> df.groupby([<span class="st">'violation_code'</span>, <span class="st">'violation_description'</span>]).<span class="bu">apply</span>(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: x[<span class="st">'ticket_number'</span>].nunique() <span class="op">*</span> (x[x[<span class="st">'total_payments'</span>] <span class="op">&gt;</span> <span class="dv">0</span>][<span class="st">'ticket_number'</span>].nunique() <span class="op">/</span> x[<span class="st">'ticket_number'</span>].nunique())</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>).reset_index(name<span class="op">=</span><span class="st">'product'</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort to find the top three violation types based on potential revenue (product)</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>top_violations <span class="op">=</span> df_grouped.sort_values(by<span class="op">=</span><span class="st">'product'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">3</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>top_violations[[<span class="st">'violation_code'</span>, <span class="st">'violation_description'</span>, <span class="st">'product'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/b0/6kybjmv57sv8drq7v4kr7w240000gn/T/ipykernel_2628/145113783.py:3: DeprecationWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  df_grouped = df.groupby(['violation_code', 'violation_description']).apply(</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">violation_code</th>
<th data-quarto-table-cell-role="th">violation_description</th>
<th data-quarto-table-cell-role="th">product</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">101</td>
<td>0976160F</td>
<td>EXPIRED PLATES OR TEMPORARY REGISTRATION</td>
<td>12482.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53</td>
<td>0964150B</td>
<td>PARKING/STANDING PROHIBITED ANYTIME</td>
<td>8689.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21</td>
<td>0964080A</td>
<td>RUSH HOUR PARKING</td>
<td>6223.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Headlines and sub-messages # Q1 # Make a dataframe for violation description, fraction of payment time, average level 1 fine # The top 5 are EXPIRED PLATES OR TEMPORARY REGISTRATION, STREET CLEANING, RESIDENTIAL PERMIT PARKING, EXP. METER NON-CENTRAL BUSINESS DISTRICT, PARKING/STANDING PROHIBITED ANYTIME</p>
<div id="bbad8a1d" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df.head()</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Group by description</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> df.groupby(<span class="st">'violation_description'</span>).agg(</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    fraction_tickets_paid<span class="op">=</span>(<span class="st">'total_payments'</span>, <span class="kw">lambda</span> x: (x <span class="op">&gt;</span> <span class="dv">0</span>).mean()),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    avg_fine_level1<span class="op">=</span>(<span class="st">'fine_level1_amount'</span>, <span class="st">'mean'</span>),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    total_tickets<span class="op">=</span>(<span class="st">'violation_description'</span>, <span class="st">'size'</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Rank from high to low</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>sorted_df <span class="op">=</span> grouped.sort_values(<span class="st">'total_tickets'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">#top 5 and print</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>top_5_violations <span class="op">=</span> sorted_df.head(<span class="dv">5</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_5_violations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        violation_description  fraction_tickets_paid  \
23   EXPIRED PLATES OR TEMPORARY REGISTRATION               0.608065   
101                           STREET CLEANING               0.815896   
90                 RESIDENTIAL PERMIT PARKING               0.745978   
19   EXP. METER NON-CENTRAL BUSINESS DISTRICT               0.795485   
81        PARKING/STANDING PROHIBITED ANYTIME               0.710677   

     avg_fine_level1  total_tickets  
23         54.968869          44811  
101        54.004249          28712  
90         66.338302          23683  
19         46.598058          20600  
81         66.142864          19753  </code></pre>
</div>
</div>
</section>
<section id="q2-1" class="level1">
<h1>Q2</h1>
<div id="9d1be832" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df_100 <span class="op">=</span> df.groupby(<span class="st">'violation_description'</span>).<span class="bu">filter</span>(<span class="kw">lambda</span> x: <span class="bu">len</span>(x) <span class="op">&gt;=</span> <span class="dv">100</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>grouped2 <span class="op">=</span> df_100.groupby(<span class="st">'violation_description'</span>).agg(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    fraction_tickets_paid<span class="op">=</span>(<span class="st">'total_payments'</span>, <span class="kw">lambda</span> x: (x <span class="op">&gt;</span> <span class="dv">0</span>).mean()),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    avg_fine_level1_2<span class="op">=</span>(<span class="st">'fine_level1_amount'</span>, <span class="kw">lambda</span> x: (x <span class="op">+</span> df_100.loc[x.index, <span class="st">'fine_level2_amount'</span>]).mean()),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    total_tickets<span class="op">=</span>(<span class="st">'violation_description'</span>, <span class="st">'size'</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grouped2)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Drop the outlier</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>max_2 <span class="op">=</span> grouped2[<span class="st">'avg_fine_level1_2'</span>].<span class="bu">max</span>()</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (max_2) <span class="co">#1455.34</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>grouped2 <span class="op">=</span> grouped2[grouped2[<span class="st">'avg_fine_level1_2'</span>] <span class="op">!=</span> max_2]</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co">#create scatter and print</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>plt.scatter(grouped2[<span class="st">'avg_fine_level1_2'</span>], grouped2[<span class="st">'fraction_tickets_paid'</span>], color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Scatter Plot: Avg Fine Level vs. Fraction of Tickets Paid'</span>)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Average Fine Level 1 &amp; 2'</span>)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Fraction of Tickets Paid'</span>)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Alternative 1: Bar Plot</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create bins for avg_fine_level1_2</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>grouped2[<span class="st">'fine_bins'</span>] <span class="op">=</span> pd.cut(grouped2[<span class="st">'avg_fine_level1_2'</span>], bins<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by bins and get the mean of the fraction of tickets paid</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>bin_group <span class="op">=</span> grouped2.groupby(<span class="st">'fine_bins'</span>).agg(</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    avg_fraction_paid<span class="op">=</span>(<span class="st">'fraction_tickets_paid'</span>, <span class="st">'mean'</span>),</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    count<span class="op">=</span>(<span class="st">'violation_description'</span>, <span class="st">'size'</span>)  <span class="co"># Count the number of violations in each bin</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the bar plot</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>plt.bar(bin_group[<span class="st">'fine_bins'</span>].astype(<span class="bu">str</span>), bin_group[<span class="st">'avg_fraction_paid'</span>], color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Bar Plot: Average Fraction of Tickets Paid by Fine Bins'</span>)</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Fine Level Bins'</span>)</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Fraction of Tickets Paid'</span>)</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a><span class="co">#Alternative 2: Box plot</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Create bins for avg_fine_level1_2 to use as categories in the box plot</span></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>grouped2[<span class="st">'fine_bins'</span>] <span class="op">=</span> pd.cut(grouped2[<span class="st">'avg_fine_level1_2'</span>], bins<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the box plot</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>grouped2.boxplot(column<span class="op">=</span><span class="st">'fraction_tickets_paid'</span>, by<span class="op">=</span><span class="st">'fine_bins'</span>, grid<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Box Plot: Distribution of Fraction of Tickets Paid by Fine Levels'</span>)</span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">''</span>)  <span class="co"># Remove the automatic subtitle</span></span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Fine Level Bins'</span>)</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Fraction of Tickets Paid'</span>)</span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a><span class="co">#In my opinion, the scatter plot is the most effective of the three for demonstration purposes, as it provides a more comprehensive and aggregate view of the data. The other two plots, while useful, are susceptible to the issue we discussed in the lecture — the arbitrariness of bin widths or categories. Deciding how to break down the data in a meaningful way requires further guidance to avoid introducing bias or misinterpretation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       violation_description  fraction_tickets_paid  \
0                            20'OF CROSSWALK               0.722646   
1                          3-7 AM SNOW ROUTE               0.730632   
2    ABANDONED VEH. FOR 7 DAYS OR INOPERABLE               0.254529   
3       BLOCK ACCESS/ALLEY/DRIVEWAY/FIRELANE               0.661178   
4      BURGLAR ALARM SOUNDING OVER 4 MINUTES               0.764706   
..                                       ...                    ...   
61  TRUCK,RV,BUS, OR TAXI RESIDENTIAL STREET               0.695761   
62     TWO HEAD LAMPS REQUIRED VISIBLE 1000'               0.600451   
63       WINDOWS MISSING OR CRACKED BEYOND 6               0.609375   
64                WITHIN 15' OF FIRE HYDRANT               0.688565   
65         WRONG DIRECTION OR 12'' FROM CURB               0.774077   

    avg_fine_level1_2  total_tickets  
0          174.122137            393  
1          166.805721            839  
2          217.391304           1104  
3          408.343889           1579  
4          124.264706            102  
..                ...            ...  
61         113.275214           4789  
62          75.000000            443  
63          75.000000            576  
64         348.238860           6104  
65          75.000000           1111  

[66 rows x 4 columns]
1455.3435114503816</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ps2%20JL_files/figure-html/cell-13-output-2.png" width="663" height="523" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/b0/6kybjmv57sv8drq7v4kr7w240000gn/T/ipykernel_2628/2759984048.py:30: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  bin_group = grouped2.groupby('fine_bins').agg(</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ps2%20JL_files/figure-html/cell-13-output-4.png" width="663" height="593" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 768x576 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ps2%20JL_files/figure-html/cell-13-output-6.png" width="606" height="509" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="understanding-the-structure-of-the-data-and-summarizing-it" class="level1">
<h1>Understanding the structure of the data and summarizing it</h1>
</section>
<section id="q1-1" class="level1">
<h1>Q1</h1>
<div id="18a1a1db" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for violations where the fine increases by less than double</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>df_non_double <span class="op">=</span> df_100[df_100[<span class="st">'fine_level2_amount'</span>] <span class="op">&lt;</span> <span class="dv">2</span> <span class="op">*</span> df_100[<span class="st">'fine_level1_amount'</span>]]</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the increase (percentage or absolute) between fine levels</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>df_non_double[<span class="st">'increase'</span>] <span class="op">=</span> (df_non_double[<span class="st">'fine_level2_amount'</span>] <span class="op">-</span> df_non_double[<span class="st">'fine_level1_amount'</span>]) <span class="op">/</span> df_non_double[<span class="st">'fine_level1_amount'</span>]</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only violation_description and the calculated increase</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>df_non_double_selected <span class="op">=</span> df_non_double[[<span class="st">'violation_description'</span>, <span class="st">'increase'</span>]]</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the result</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_non_double_selected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           violation_description  increase
13                         DISABLED PARKING ZONE  0.250000
26                         DISABLED PARKING ZONE  0.250000
40                           PARK OR BLOCK ALLEY  0.666667
46                           PARK OR BLOCK ALLEY  0.666667
67                           PARK OR BLOCK ALLEY  0.666667
...                                          ...       ...
157991  NO CITY STICKER VEHICLE OVER 16,000 LBS.  0.550000
159471  NO CITY STICKER VEHICLE OVER 16,000 LBS.  0.550000
159689  NO CITY STICKER VEHICLE OVER 16,000 LBS.  0.550000
159987  NO CITY STICKER VEHICLE OVER 16,000 LBS.  0.550000
160124  NO CITY STICKER VEHICLE OVER 16,000 LBS.  0.550000

[3976 rows x 2 columns]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/b0/6kybjmv57sv8drq7v4kr7w240000gn/T/ipykernel_2628/2526005368.py:5: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_non_double['increase'] = (df_non_double['fine_level2_amount'] - df_non_double['fine_level1_amount']) / df_non_double['fine_level1_amount']</code></pre>
</div>
</div>
<div id="8b76dd7a" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a graph for Notice Level Diagram</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>notice_graph <span class="op">=</span> nx.DiGraph()</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add nodes and edges for notice level progression</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>notice_graph.add_edges_from([</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Initial Notice'</span>, <span class="st">'Second Notice'</span>),</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Second Notice'</span>, <span class="st">'Final Notice'</span>),</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Contested'</span>, <span class="st">'Not Liable'</span>),</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the conditional path if the ticket is contested and found not liable</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>notice_graph.add_edge(<span class="st">'Second Notice'</span>, <span class="st">'Contested'</span>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a graph for Ticket Queue Diagram</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>ticket_graph <span class="op">=</span> nx.DiGraph()</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Add nodes and edges for ticket queue progression</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>ticket_graph.add_edges_from([</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Issued'</span>, <span class="st">'Unpaid'</span>),</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Unpaid'</span>, <span class="st">'Collections'</span>),</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Contested'</span>, <span class="st">'Not Liable'</span>),</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Issued'</span>, <span class="st">'Contested'</span>),</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Unpaid'</span>, <span class="st">'Paid'</span>),</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Notice Level Diagram</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>nx.draw(notice_graph, with_labels<span class="op">=</span><span class="va">True</span>, node_color<span class="op">=</span><span class="st">'lightblue'</span>, node_size<span class="op">=</span><span class="dv">2000</span>, font_size<span class="op">=</span><span class="dv">10</span>, font_weight<span class="op">=</span><span class="st">'bold'</span>, arrows<span class="op">=</span><span class="va">True</span>, pos<span class="op">=</span>nx.spring_layout(notice_graph))</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Notice Level Diagram"</span>)</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Ticket Queue Diagram</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>nx.draw(ticket_graph, with_labels<span class="op">=</span><span class="va">True</span>, node_color<span class="op">=</span><span class="st">'lightgreen'</span>, node_size<span class="op">=</span><span class="dv">2000</span>, font_size<span class="op">=</span><span class="dv">10</span>, font_weight<span class="op">=</span><span class="st">'bold'</span>, arrows<span class="op">=</span><span class="va">True</span>, pos<span class="op">=</span>nx.spring_layout(ticket_graph))</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ticket queue Diagram"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>Text(0.5, 1.0, 'ticket queue Diagram')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ps2%20JL_files/figure-html/cell-15-output-2.png" width="763" height="409" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="q3-resorted-help-from-stackoverflow-and-chat-gpt" class="level1">
<h1>Q3: Resorted help from StackOverflow and Chat GPT</h1>
</section>
<section id="a" class="level1">
<h1>a</h1>
<div id="c8c925b5" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the top 10 most common violation descriptions</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>top_violations <span class="op">=</span> grouped2[<span class="st">'violation_description'</span>].value_counts().nlargest(<span class="dv">10</span>).index</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new column to classify violations</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>grouped2[<span class="st">'violation_category'</span>] <span class="op">=</span> grouped2[<span class="st">'violation_description'</span>].<span class="bu">apply</span>(</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> top_violations <span class="cf">else</span> <span class="st">'Other'</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for distinct categories for coloring</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>unique_categories <span class="op">=</span> grouped2[<span class="st">'violation_category'</span>].unique()</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a color map for each category</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> plt.cm.get_cmap(<span class="st">'tab10'</span>, <span class="bu">len</span>(unique_categories))</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the scatter plot with labeled dots</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, category <span class="kw">in</span> <span class="bu">enumerate</span>(unique_categories):</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> grouped2[grouped2[<span class="st">'violation_category'</span>] <span class="op">==</span> category]</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    plt.scatter(subset[<span class="st">'avg_fine_level1_2'</span>], subset[<span class="st">'fraction_tickets_paid'</span>], label<span class="op">=</span>category, color<span class="op">=</span>colors(i))</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels for the top 10 violations</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(grouped2)):</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    row <span class="op">=</span> grouped2.iloc[i]</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="st">'violation_category'</span>] <span class="op">!=</span> <span class="st">'Other'</span>:</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>        plt.text(row[<span class="st">'avg_fine_level1_2'</span>], row[<span class="st">'fraction_tickets_paid'</span>], row[<span class="st">'violation_description'</span>], fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title, labels, and legend</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Scatter Plot: Avg Fine Level vs. Fraction of Tickets Paid'</span>)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Average Fine Level 1 &amp; 2'</span>)</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Fraction of Tickets Paid'</span>)</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Violation Description'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/b0/6kybjmv57sv8drq7v4kr7w240000gn/T/ipykernel_2628/3998723457.py:13: MatplotlibDeprecationWarning: The get_cmap function was deprecated in Matplotlib 3.7 and will be removed in 3.11. Use ``matplotlib.colormaps[name]`` or ``matplotlib.colormaps.get_cmap()`` or ``pyplot.get_cmap()`` instead.
  colors = plt.cm.get_cmap('tab10', len(unique_categories))</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ps2%20JL_files/figure-html/cell-16-output-2.png" width="1124" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="b" class="level1">
<h1>b</h1>
<div id="ce877af4" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define broader categories for similar violations</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> categorize_violation(description):</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'parking'</span> <span class="kw">in</span> description.lower():</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Parking Violation'</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">'expired'</span> <span class="kw">in</span> description.lower() <span class="kw">or</span> <span class="st">'meter'</span> <span class="kw">in</span> description.lower():</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Expired Meter'</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">'loading'</span> <span class="kw">in</span> description.lower():</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Loading Zone Violation'</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to categorize violations</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>grouped2[<span class="st">'violation_category'</span>] <span class="op">=</span> grouped2[<span class="st">'violation_description'</span>].<span class="bu">apply</span>(categorize_violation)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique categories for coloring</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>unique_categories <span class="op">=</span> grouped2[<span class="st">'violation_category'</span>].unique()</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a scatter plot with different colors for each category</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, category <span class="kw">in</span> <span class="bu">enumerate</span>(unique_categories):</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> grouped2[grouped2[<span class="st">'violation_category'</span>] <span class="op">==</span> category]</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>    plt.scatter(subset[<span class="st">'avg_fine_level1_2'</span>], subset[<span class="st">'fraction_tickets_paid'</span>], label<span class="op">=</span>category, color<span class="op">=</span>colors(i))</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title, labels, and legend</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Scatter Plot: Avg Fine Level vs. Fraction of Tickets Paid (Categorized)'</span>)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Average Fine Level 1 &amp; 2'</span>)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Fraction of Tickets Paid'</span>)</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Violation Category'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ps2%20JL_files/figure-html/cell-17-output-1.png" width="901" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>